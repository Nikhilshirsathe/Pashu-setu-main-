-- Enable UUID extension\nCREATE EXTENSION IF NOT EXISTS \"uuid-ossp\";\n\n-- Animals table\nCREATE TABLE animals (\n  id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,\n  name VARCHAR(255) NOT NULL,\n  species VARCHAR(100) NOT NULL,\n  breed VARCHAR(100),\n  age INTEGER,\n  owner_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,\n  image_url TEXT,\n  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n);\n\n-- Health records table\nCREATE TABLE health_records (\n  id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,\n  animal_id UUID REFERENCES animals(id) ON DELETE CASCADE,\n  tag_number VARCHAR(100),\n  sex VARCHAR(20),\n  weight DECIMAL(10,2),\n  growth_stage VARCHAR(50),\n  temperature DECIMAL(5,2),\n  respiratory_rate INTEGER,\n  heart_rate INTEGER,\n  feed_intake TEXT,\n  water_intake TEXT,\n  vaccination_record TEXT,\n  past_illness TEXT,\n  medication TEXT,\n  diagnosis TEXT,\n  treatment TEXT,\n  symptoms TEXT,\n  vet_id UUID REFERENCES auth.users(id),\n  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n);\n\n-- Enable Row Level Security\nALTER TABLE animals ENABLE ROW LEVEL SECURITY;\nALTER TABLE health_records ENABLE ROW LEVEL SECURITY;\n\n-- Policies for animals table\nCREATE POLICY \"Users can view their own animals\" ON animals\n  FOR SELECT USING (auth.uid() = owner_id);\n\nCREATE POLICY \"Users can insert their own animals\" ON animals\n  FOR INSERT WITH CHECK (auth.uid() = owner_id);\n\nCREATE POLICY \"Users can update their own animals\" ON animals\n  FOR UPDATE USING (auth.uid() = owner_id);\n\nCREATE POLICY \"Users can delete their own animals\" ON animals\n  FOR DELETE USING (auth.uid() = owner_id);\n\n-- Policies for health_records table\nCREATE POLICY \"Users can view health records for their animals\" ON health_records\n  FOR SELECT USING (\n    EXISTS (\n      SELECT 1 FROM animals \n      WHERE animals.id = health_records.animal_id \n      AND animals.owner_id = auth.uid()\n    )\n  );\n\nCREATE POLICY \"Users can insert health records for their animals\" ON health_records\n  FOR INSERT WITH CHECK (\n    EXISTS (\n      SELECT 1 FROM animals \n      WHERE animals.id = health_records.animal_id \n      AND animals.owner_id = auth.uid()\n    )\n  );\n\nCREATE POLICY \"Users can update health records for their animals\" ON health_records\n  FOR UPDATE USING (\n    EXISTS (\n      SELECT 1 FROM animals \n      WHERE animals.id = health_records.animal_id \n      AND animals.owner_id = auth.uid()\n    )\n  );\n\nCREATE POLICY \"Users can delete health records for their animals\" ON health_records\n  FOR DELETE USING (\n    EXISTS (\n      SELECT 1 FROM animals \n      WHERE animals.id = health_records.animal_id \n      AND animals.owner_id = auth.uid()\n    )\n  );\n